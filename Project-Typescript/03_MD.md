# 3 Modelagem e Design – CRUD de Usuários

## Modelos de Dados

**Entidade principal:** `User`

| Atributo  | Tipo   | Obrigatório | Observações             |
| --------- | ------ | ----------- | ----------------------- |
| id        | number | Sim         | PK, autoincremental     |
| name      | string | Sim         | Nome do usuário         |
| email     | string | Sim         | Deve ser único e válido |
| createdAt | Date   | Sim         | Data de criação         |
| updatedAt | Date   | Sim         | Data de atualização     |

> Para este CRUD, apenas a entidade `User` é necessária. Futuras entidades (ex.: `Role`, `Permission`) podem ser adicionadas.

---

## Relacionamentos

-   Não há relacionamentos entre entidades no momento.
-   Futuramente, se houver mais entidades, podem ser adicionadas relações 1\:N ou N\:N.

---

## Diagrama de Classes (Simplificado)

```text
+----------------+
|      User      |
+----------------+
| - id: number   |
| - name: string |
| - email: string|
| - createdAt: Date |
| - updatedAt: Date |
+----------------+
| + create()     |
| + read()       |
| + update()     |
| + delete()     |
+----------------+
```

> Métodos CRUD implementados em **services**, mantendo controllers limpos.

---

## Estrutura de Pastas (Backend)

**Em Camadas (recomendado):**

```
/src
  /presentation
    /controllers
      userController.ts
    /routes
      userRoutes.ts
  /application
    /services
      userService.ts
  /domain
    /entities
      user.ts
    /repositories
      userRepository.ts
  /infrastructure
    /database
      sqliteClient.ts
    /persistence
      userRepositoryImpl.ts
  /utils
    validation.ts
  app.ts
```

**MVC (alternativa para protótipo rápido):**

```
/src
  /controllers
    userController.ts
  /models
    userModel.ts
  /routes
    userRoutes.ts
  /utils
    validation.ts
  app.ts
```

---

## Separação de Responsabilidades

| Camada                       | Responsabilidade                                              |
| ---------------------------- | ------------------------------------------------------------- |
| Presentation / Controllers   | Receber requisições, validar dados básicos, chamar services   |
| Application / Services       | Lógica de negócio (criação, atualização, exclusão, validação) |
| Domain / Entities            | Modelos de dados e regras de negócio do `User`                |
| Infrastructure / Persistence | Acesso ao banco de dados, implementação de repositórios       |
| Utils                        | Funções auxiliares, validação, formatação                     |

---

## Padrões de Projeto

-   **Singleton:** conexão SQLite (`sqliteClient.ts`)
-   **Factory:** criação de objetos `User`
-   **Strategy (opcional):** validação de dados ou filtros

> Observer não é necessário nesse CRUD básico.

---

## Princípios de Design

-   **SOLID:** Single Responsibility nos services, Open/Closed na lógica de negócio
-   **DRY:** evitar duplicação em controllers e services
-   **KISS:** manter CRUD simples e direto

---

## Uso de Schemas / DTOs

-   **Abordagem escolhida:** TypeScript **interfaces/classes** para DTOs
-   Exemplo:

```ts
interface UserDTO {
    name: string
    email: string
}
```

-   Benefícios: validação automática de tipos, transporte seguro de dados, desacoplamento de entidades e payloads da API.

> Alternativa sem DTO: trabalhar diretamente com objetos JSON, mas menos seguro.

---

## Estratégia de Tratamento de Erros/Exceções

-   **Abordagem escolhida:** Imperativa tradicional

    -   `try/catch` para capturar erros de banco e validação
    -   Retornar mensagens claras via JSON para frontend

-   Exemplo:

```ts
try {
    const user = await userService.create(data)
    res.status(201).json(user)
} catch (error) {
    res.status(400).json({ message: error.message })
}
```

> Futuramente, pode-se evoluir para abordagem funcional (Result / Either) para encadeamento de erros.

---

## Estrutura de Pastas (Frontend – React + Vite)

```
/src
  /components
    UserForm.tsx
    UserList.tsx
  /pages
    Home.tsx
  /services
    api.ts
  /utils
    validation.ts
  App.tsx
  main.tsx
```

> Comunicação com backend via `axios` ou `fetch`, usando JSON.
